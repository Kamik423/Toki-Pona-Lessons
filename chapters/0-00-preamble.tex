%!TEX root = ../toki-pona.tex

\documentclass[a4paper, 10pt]{book}

\usepackage[bottom=0.75in]{geometry}
\usepackage{graphicx}
\usepackage{fontspec}
\usepackage{microtype}
\usepackage[table]{xcolor}
\definecolor{tpyellow}{HTML}{FBFC63}    % #FBFC63
\definecolor{tpblue}{HTML}{0A0385}      % #0A0385
\definecolor{tppink}{HTML}{b55d97}      % #b55d97
\definecolor{tppurple}{HTML}{2a1f32}    % #2a1f32
\definecolor{tpgray}{HTML}{e2e6dd}      % #e2e6dd
\usepackage{hyperref}
\hypersetup{%
    pdfauthor={Sonja Lang, B. J. Knight, Robert Warnke, Hans SchÃ¼lein},
    pdftitle={Toki Pona---The Simplest Language in the World---Grammar and Vocabulary Lessons},
    pdfsubject={Toki Pona---The Simplest Language in the World---Grammar and Vocabulary Lessons},
    pdfkeywords={Toki Pona, a akesi ala ale ali anpa ante anu awen e en ijo ike ilo insa jaki jan jelo jo kala kalama kama kasi ken kepeken kili kin kiwen ko kon kule kulupu kute la lape laso lawa  len lete li lili linja lipu loje lon luka lukin lupa ma mama mani meli mi mije moku moli monsi mu mun musi mute nanpa nasa nasin nena ni nimi noka o oko olin ona open pakala pali palisa pana pi pilin pimeja pini pipi poka poki pona sama seli selo seme sewi sijelo sike sin sina sinpin sitelen sona soweli suli suno supa suwi tan taso tawa telo tenpo toki tomo tu unpa uta utala walo wan waso wawa weka wile },
    colorlinks=true,
    urlcolor=tpblue,
    linkcolor=tppink,
    citecolor=tppink,
    menucolor=red,
    draft=false,
}

\usepackage{DejaVuSansMono}
\usepackage[light]{merriweather}
\usepackage[default, oldstyle]{opensans}
\setmonofont[Scale=0.95]{DejaVu Sans Mono}

\usepackage{titling}
\usepackage{makeidx}
\makeindex

\usepackage{bbding}
\usepackage{booktabs}
\usepackage{environ}
\usepackage{exsheets}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{ifoddpage}
\usepackage{longtable}\setlength{\LTpre}{0pt}\setlength{\LTpost}{0pt}
\usepackage[fulladjust]{marginnote}
\usepackage{multirow}
\usepackage{sectsty}
\usepackage{supertabular}
\usepackage{tabu}
\usepackage{tabularx}
\usepackage{tcolorbox}\tcbuselibrary{breakable}
\usepackage{textcomp}
\usepackage{tikz}
\usepackage{titlesec}
\usepackage{ulem}
\usepackage{verbatimbox}
\usepackage{qrcode}

\usepackage{array}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}

\graphicspath{{images/}}

\titlespacing*{\chapter}{0pt}{0pt}{30pt}
\sectionfont{\color{tppink}}
% \subsectionfont{\color{tppink}}

% Use to format toki pona text
\newcommand{\tpfamily}{\merriweather\addfontfeature{Scale=0.97}}
\DeclareTextFontCommand{\texttp}{\tpfamily}

% Mark words like ``separator'' or ``adverb'' in table
\newcommand{\wordtype}[1]{\mbox{\color{tppink}\textit{#1}}}

% This entire line is made of hacks and deserves fixing
% \newcommand{\wordrule}{\\[-1.2em]\noalign{\color{white}\hrule height 2pt}\\[-1em]}
\newcommand{\wordrule}{\\[-1.2em]\specialrule{2pt}{0pt}{0pt}\\[-1em]}

\newenvironment{tablebox}{
    \begin{tcolorbox}[
            width=\linewidth,
            size=minimal,
            colback=tpgray,
            opacityframe=0.0,
            before skip=1ex,
            after skip=1ex,
            breakable,
        ]%
        \arrayrulecolor{white}%
        }{
        \arrayrulecolor{black}%
    \end{tcolorbox}%
    \noindent%
}

\NewEnviron{vocabularytable}{%
    \begin{tablebox}%
        \begin{tabularx}{\linewidth}{>{\tpfamily}l!{\color{white}\vrule width 2pt}X}
            \hspace{1.5cm} & \\[-1.1em] % Same hack as \wordrule, minimal column width
            \BODY
        \end{tabularx}%
    \end{tablebox}%
    \noindent%
}
\NewEnviron{translationtable}{%

    \begin{tablebox}%
        \begin{tabularx}{\linewidth}{>{\tpfamily}X!{\color{white}\vrule width 2pt}X}
            \\[-1.1em] % Same hack as \wordrule
            \BODY
        \end{tabularx}%
    \end{tablebox}%
    \noindent%
}

\newcommand{\answerstyle}[1]{\textit{\color{tppurple}#1}}
\newcommand{\answer}[1]{}
\newcommand{\showanswer}[1]{\answerstyle{#1}}
\SetupExSheets{
    headings=block-subtitle,
    headings-format=\large\bfseries,
    subtitle-format=\large\bfseries,
    counter-format=qu,
}
\SetupExSheets[question]{
    name=Practice,
    pre-hook=\noindent\begin{minipage}{\linewidth},
        post-body-hook=\end{minipage},
}
\SetupExSheets[solution]{
    name=Solution for Practice,
}
% I tried to do this as an environment, but I could not get it to work using \BODY twice in a nice way.
\newcommand{\practice}[2][Please write down your answers and check them afterwards.]{
    \vspace{2em}
    \renewcommand{\answer}[1]{\vphantom{\parbox[c]{\linewidth}{##1}}}
    \renewcommand{\showanswer}[1]{\answerstyle{##1}\answer{}}
    \checkoddpage
    \begin{question}[subtitle={(Answers: Page~\pageref{exerciseanswer\CurrentQuestionID})\marginnote{\normalfont\selectfont\color{tppink}\Large\ifoddpage{\HandPencilLeft}\else{\reflectbox{\HandPencilLeft}}\fi}}]
        #1

        \begin{tablebox}%
            \begin{tabularx}{\linewidth}{X!{\color{white}\vrule width 2pt}X}
                \\[-1.1em] % Same hack as \wordrule
                #2
            \end{tabularx}%
        \end{tablebox}
    \end{question}
    \renewcommand{\answer}[1]{\answerstyle{##1}}
    \renewcommand{\showanswer}[1]{\answerstyle{##1}}
    \begin{solution}
        \label{exerciseanswer\CurrentQuestionID}%
        \renewcommand{\footnotemark}{}%
        \begin{tablebox}%
            \begin{longtable}{L{.48\linewidth}!{\color{white}\vrule width 2pt}L{.48\linewidth}}%
                \\[-1.1em] % Same hack as \wordrule
                #2
            \end{longtable}%
        \end{tablebox}%
    \end{solution}
}
